FROM ##PREFIX##-base-apt-packages

ENV CONDA_DIR /opt/conda
ENV PATH $CONDA_DIR/bin:$PATH
ENV SHELL /bin/bash
ENV LC_ALL en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US.UTF-8

# Create conda dir
RUN mkdir -p $CONDA_DIR

# Install conda
RUN cd /tmp && \
    mkdir -p $CONDA_DIR && \
    ANACONDA="Anaconda3-2020.02-Linux-x86_64.sh" && \
    wget --quiet https://repo.anaconda.com/archive/${ANACONDA} && \
    #FIXME: check sum
    /bin/bash ${ANACONDA} -f -b -p $CONDA_DIR && \
    rm ${ANACONDA}

RUN /opt/conda/bin/conda update -y conda

COPY 99-notebook /init/99-notebook
RUN chmod +x /init/99-notebook
COPY start-notebook.sh /usr/local/bin/
COPY preview-bokeh.sh /usr/local/bin/
COPY preview-nb-api.sh /usr/local/bin/
RUN chmod a+x /usr/local/bin/start-notebook.sh /usr/local/bin/preview-bokeh.sh /usr/local/bin/preview-nb-api.sh
ADD jupyter-notebook-kooplex /opt/conda/bin/jupyter-notebook-kooplex
RUN chmod a+x /opt/conda/bin/jupyter-notebook-kooplex
ADD kooplex-logo.png /opt/conda/lib/python3.7/site-packages/notebook/static/base/images/kooplex-logo.png
ADD kooplex-logo.png /opt/conda/lib/python3.7/site-packages/notebook/static/base/images/jupyterlab.png

RUN sed -i -e "s/^\(UMASK\).*/\1 0002/" /etc/login.defs

ADD jupyter_notebook_config.py /etc/jupyter_notebook_config.py
ADD jupyter_report_config.py /etc/jupyter_report_config.py

